---
// src/components/Sidebar.astro
---
<aside class="w-56 bg-white dark:bg-gray-800 shadow-lg border-r border-gray-200 dark:border-gray-700 flex flex-col fixed top-0 left-0 h-full pt-[60px] z-40 transition-colors duration-300">
    <nav class="flex-grow p-4 space-y-2">
        <!-- Enlace Principal -->
        <a href="/dashboard" class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-700 hover:text-blue-700 dark:hover:text-blue-100 transition-colors duration-200 font-medium">
            <i data-lucide="home" class="w-6 h-6"></i>
            <span>Principal</span>
        </a>
        <!-- Enlace Añadir Transacción -->
        <a href="/dashboard/add-transaction" class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-700 hover:text-blue-700 dark:hover:text-blue-100 transition-colors duration-200 font-medium">
            <i data-lucide="plus-circle" class="w-6 h-6"></i>
            <span>Añadir Transacción</span>
        </a>
        <!-- Enlace Estadísticas -->
        <a href="/dashboard/statistics" class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-700 hover:text-blue-700 dark:hover:text-blue-100 transition-colors duration-200 font-medium">
            <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
            <span>Estadísticas</span>
        </a>
        <!-- Enlace Resumen -->
        <a href="/dashboard/summary" class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-700 hover:text-blue-700 dark:hover:text-blue-100 transition-colors duration-200 font-medium">
            <i data-lucide="clipboard-list" class="w-6 h-6"></i>
            <span>Resumen</span>
        </a>
        <!-- Enlace Cuentas -->
        <a href="/dashboard/accounts" class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-700 hover:text-blue-700 dark:hover:text-blue-100 transition-colors duration-200 font-medium">
            <i data-lucide="banknote" class="w-6 h-6"></i>
            <span>Cuentas</span>
        </a>
        <!-- Enlace Empresas -->
        <a href="/dashboard/companies" class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-700 hover:text-blue-700 dark:hover:text-blue-100 transition-colors duration-200 font-medium">
            <i data-lucide="building" class="w-6 h-6"></i>
            <span>Empresas</span>
        </a>
        <!-- Enlace Notificaciones -->
        <a href="/dashboard/notifications" class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-700 hover:text-blue-700 dark:hover:text-blue-100 transition-colors duration-200 font-medium">
            <i data-lucide="bell" class="w-6 h-6"></i>
            <span>Notificaciones</span>
        </a>
    </nav>

    <div class="p-4 border-t border-gray-200 dark:border-gray-700 mt-auto transition-colors duration-300">
        <!-- Enlace Cuenta (Configuración) -->
        <a href="/dashboard/settings" class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-700 hover:text-blue-700 dark:hover:text-blue-100 transition-colors duration-200 font-medium">
            <i data-lucide="settings" class="w-6 h-6"></i>
            <span>Configuración</span>
        </a>
        <!-- Botón de Cerrar Sesión (Duplicado del header, si lo quieres también aquí) -->
        <button id="logoutButtonSidebar" class="flex items-center space-x-3 p-3 rounded-lg text-red-600 dark:text-red-300 hover:bg-red-100 dark:hover:bg-red-800 hover:text-red-700 dark:hover:text-red-100 transition-colors duration-200 font-medium w-full text-left">
            <i data-lucide="log-out" class="w-6 h-6"></i>
            <span>Cerrar Sesión</span>
        </button>
    </div>
</aside>

<script is:inline>
    // Script para resaltar el enlace activo en la barra lateral
    document.addEventListener('DOMContentLoaded', () => {
        const currentPath = window.location.pathname;
        const sidebarLinks = document.querySelectorAll('.sidebar-link');
        const logoutButtonSidebar = document.getElementById('logoutButtonSidebar');

        sidebarLinks.forEach(link => {
            const linkPath = link.getAttribute('href').replace(/\/$/, '');
            const normalizedCurrentPath = currentPath.replace(/\/$/, '');

            if (linkPath === normalizedCurrentPath || (linkPath !== '/dashboard' && normalizedCurrentPath.startsWith(linkPath))) {
                link.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                link.classList.remove('hover:bg-blue-100', 'hover:text-blue-700', 'text-gray-700', 'dark:hover:bg-blue-700', 'dark:hover:text-blue-100', 'dark:text-gray-300');
            } else {
                link.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                link.classList.add('hover:bg-blue-100', 'hover:text-blue-700', 'text-gray-700', 'dark:hover:bg-blue-700', 'dark:hover:text-blue-100', 'dark:text-gray-300');
            }
        });

        // Manejar el botón de cerrar sesión en la barra lateral (duplicado del header)
        if (logoutButtonSidebar) {
            logoutButtonSidebar.addEventListener('click', async () => {
                try {
                    const response = await fetch('/api/auth/logout', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    if (response.ok) {
                        window.location.href = '/login';
                    } else {
                        const errorData = await response.json();
                        console.error('Error al cerrar sesión desde la barra lateral:', errorData.message);
                        alert('Error al cerrar sesión: ' + (errorData.message || 'Desconocido')); // Usar un modal en una app real
                    }
                } catch (error) {
                    console.error('Error de red al cerrar sesión desde la barra lateral:', error);
                    alert('Error de red al cerrar sesión desde la barra lateral.'); // Usar un modal en una app real
                }
            });
        }
    });
</script>