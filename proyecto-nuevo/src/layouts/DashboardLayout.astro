---
import BaseLayout from "./Layout.astro";
import DashboardSidebar from "../components/DashboardSidebar.astro";
import DashboardHeader from "../components/DashboardHeader.astro";

const { title } = Astro.props;
const currentPath = Astro.url.pathname;
---

<BaseLayout title={title}>
    <div
        class="flex h-screen bg-gray-50 dark:bg-gray-900 overflow-hidden font-sans"
    >
        <!-- Sidebar Reutilizable -->
        <DashboardSidebar currentPath={currentPath} />

        <!-- Contenido Principal -->
        <div class="flex-1 flex flex-col overflow-hidden relative">
            <!-- Header Reutilizable -->
            <DashboardHeader title={title} />

            <!-- Área de Contenido de la Página -->
            <main class="flex-1 overflow-y-auto p-8 scroll-smooth">
                <slot />
            </main>
        </div>
    </div>
</BaseLayout>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const userStr = localStorage.getItem("user");

        // 1. Verificación Global de Autenticación
        if (!userStr) {
            window.location.href = "/login";
            return;
        }

        const user = JSON.parse(userStr);

        // 2. Actualizar Header Global
        const headerUserName = document.getElementById("header-user-name");
        const userAvatar = document.getElementById("user-avatar");

        if (headerUserName)
            headerUserName.textContent = `${user.first_name} ${user.last_name}`;
        if (userAvatar)
            userAvatar.textContent = user.first_name.charAt(0).toUpperCase();

        // 3. Lógica Global de Logout
        const logoutBtn = document.getElementById("logout-btn");
        if (logoutBtn) {
            logoutBtn.addEventListener("click", () => {
                localStorage.removeItem("user");
                window.location.href = "/login";
            });
        }
    });
</script>
