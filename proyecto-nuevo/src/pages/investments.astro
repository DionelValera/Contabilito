---
import DashboardLayout from "../layouts/DashboardLayout.astro";
import { TrendingUp, TrendingDown, DollarSign, Activity } from "@lucide/astro";
---

<DashboardLayout title="Inversiones">
    <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-800 dark:text-white">
            Portafolio de Inversiones
        </h2>
        <p class="text-gray-500 dark:text-gray-400 mt-1">
            Sigue el rendimiento de tus activos en tiempo real.
        </p>
    </div>

    <!-- Portfolio Summary -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- Main Stats -->
        <div
            class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-8"
        >
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-6">
                Rendimiento Total
            </h3>
            <div class="flex items-end gap-4 mb-8">
                <div>
                    <p class="text-sm text-gray-500 mb-1">Valor Actual</p>
                    <h2
                        class="text-5xl font-bold text-gray-900 dark:text-white"
                    >
                        $8,900.75
                    </h2>
                </div>
                <div class="mb-2">
                    <span
                        class="inline-flex items-center px-3 py-1 rounded-full text-sm font-bold bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"
                    >
                        <TrendingUp class="w-4 h-4 mr-1" />
                        +15.3%
                    </span>
                    <p class="text-xs text-gray-400 mt-1">Este año</p>
                </div>
            </div>

            <!-- Fake Chart Bars -->
            <div class="flex items-end justify-between h-48 gap-2">
                <div
                    class="w-full bg-indigo-100 dark:bg-indigo-900/20 rounded-t-lg hover:bg-indigo-200 transition-all h-[40%] relative group"
                >
                    <div
                        class="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity"
                    >
                        Ene
                    </div>
                </div>
                <div
                    class="w-full bg-indigo-100 dark:bg-indigo-900/20 rounded-t-lg hover:bg-indigo-200 transition-all h-[55%] relative group"
                >
                    <div
                        class="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity"
                    >
                        Feb
                    </div>
                </div>
                <div
                    class="w-full bg-indigo-100 dark:bg-indigo-900/20 rounded-t-lg hover:bg-indigo-200 transition-all h-[45%] relative group"
                >
                    <div
                        class="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity"
                    >
                        Mar
                    </div>
                </div>
                <div
                    class="w-full bg-indigo-100 dark:bg-indigo-900/20 rounded-t-lg hover:bg-indigo-200 transition-all h-[60%] relative group"
                >
                    <div
                        class="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity"
                    >
                        Abr
                    </div>
                </div>
                <div
                    class="w-full bg-indigo-100 dark:bg-indigo-900/20 rounded-t-lg hover:bg-indigo-200 transition-all h-[75%] relative group"
                >
                    <div
                        class="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity"
                    >
                        May
                    </div>
                </div>
                <div
                    class="w-full bg-indigo-100 dark:bg-indigo-900/20 rounded-t-lg hover:bg-indigo-200 transition-all h-[65%] relative group"
                >
                    <div
                        class="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity"
                    >
                        Jun
                    </div>
                </div>
                <div
                    class="w-full bg-indigo-500 rounded-t-lg shadow-lg shadow-indigo-200 dark:shadow-none h-[90%] relative group"
                >
                    <div
                        class="absolute -top-8 left-1/2 -translate-x-1/2 bg-indigo-600 text-white text-xs py-1 px-2 rounded opacity-100"
                    >
                        Jul
                    </div>
                </div>
            </div>
        </div>

        <!-- Asset Allocation -->
        <div
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-8"
        >
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-6">
                Distribución de Activos
            </h3>

            <div class="flex justify-center mb-8">
                <!-- Simple CSS Pie Chart -->
                <div
                    class="w-48 h-48 rounded-full border-[16px] border-indigo-500 relative flex items-center justify-center"
                >
                    <div
                        class="absolute inset-0 rounded-full border-[16px] border-purple-400 border-l-transparent border-b-transparent rotate-45"
                    >
                    </div>
                    <div
                        class="absolute inset-0 rounded-full border-[16px] border-green-400 border-l-transparent border-b-transparent border-r-transparent -rotate-90"
                    >
                    </div>
                    <div class="text-center">
                        <span
                            class="block text-2xl font-bold text-gray-800 dark:text-white"
                            >5</span
                        >
                        <span class="text-xs text-gray-500">Activos</span>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-indigo-500"></div>
                        <span class="text-sm text-gray-600 dark:text-gray-300"
                            >Acciones (Tech)</span
                        >
                    </div>
                    <span
                        class="text-sm font-bold text-gray-800 dark:text-white"
                        >45%</span
                    >
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-purple-400"></div>
                        <span class="text-sm text-gray-600 dark:text-gray-300"
                            >Criptomonedas</span
                        >
                    </div>
                    <span
                        class="text-sm font-bold text-gray-800 dark:text-white"
                        >30%</span
                    >
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-green-400"></div>
                        <span class="text-sm text-gray-600 dark:text-gray-300"
                            >Bonos</span
                        >
                    </div>
                    <span
                        class="text-sm font-bold text-gray-800 dark:text-white"
                        >25%</span
                    >
                </div>
            </div>
        </div>
    </div>

    <!-- Assets List -->
    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">
        Mis Activos
    </h3>
    <div
        class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden"
    >
        <table class="w-full text-left">
            <thead
                class="bg-gray-50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400 text-xs uppercase font-semibold"
            >
                <tr>
                    <th class="px-6 py-4">Activo</th>
                    <th class="px-6 py-4">Símbolo</th>
                    <th class="px-6 py-4 text-right">Cantidad</th>
                    <th class="px-6 py-4 text-right">Precio Prom.</th>
                    <th class="px-6 py-4 text-right">Valor Actual</th>
                    <th class="px-6 py-4 text-right">Ganancia/Pérdida</th>
                </tr>
            </thead>
            <tbody
                id="assets-table-body"
                class="divide-y divide-gray-100 dark:divide-gray-700 text-sm"
            >
                <!-- JS Injected -->
                <tr
                    class="hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors"
                >
                    <td
                        class="px-6 py-4 font-medium text-gray-900 dark:text-gray-100"
                        >Cargando...</td
                    >
                </tr>
            </tbody>
        </table>
    </div>
</DashboardLayout>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const formatter = new Intl.NumberFormat("en-US", {
            style: "currency",
            currency: "USD",
        });

        const assets = [
            {
                name: "Apple Inc.",
                symbol: "AAPL",
                qty: 15,
                avgPrice: 145.0,
                currentPrice: 175.5,
            },
            {
                name: "Bitcoin",
                symbol: "BTC",
                qty: 0.15,
                avgPrice: 28000.0,
                currentPrice: 35000.0,
            },
            {
                name: "Tesla, Inc.",
                symbol: "TSLA",
                qty: 10,
                avgPrice: 210.0,
                currentPrice: 245.0,
            },
            {
                name: "Ethereum",
                symbol: "ETH",
                qty: 2.5,
                avgPrice: 1500.0,
                currentPrice: 1800.0,
            },
            {
                name: "S&P 500 ETF",
                symbol: "VOO",
                qty: 5,
                avgPrice: 380.0,
                currentPrice: 410.0,
            },
        ];

        const tbody = document.getElementById("assets-table-body");
        if (tbody) {
            tbody.innerHTML = assets
                .map((asset) => {
                    const totalValue = asset.qty * asset.currentPrice;
                    const costBasis = asset.qty * asset.avgPrice;
                    const profitLoss = totalValue - costBasis;
                    const profitLossPercent = (
                        (profitLoss / costBasis) *
                        100
                    ).toFixed(2);

                    const isProfitable = profitLoss >= 0;
                    const colorClass = isProfitable
                        ? "text-green-600 dark:text-green-400"
                        : "text-red-600 dark:text-red-400";
                    const sign = isProfitable ? "+" : "";

                    return `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors">
                        <td class="px-6 py-4 font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2">
                            <span class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-600 dark:text-gray-300">${asset.symbol[0]}</span>
                            ${asset.name}
                        </td>
                        <td class="px-6 py-4 text-gray-500 font-mono">${asset.symbol}</td>
                        <td class="px-6 py-4 text-right text-gray-700 dark:text-gray-300">${asset.qty}</td>
                        <td class="px-6 py-4 text-right text-gray-500">${formatter.format(asset.avgPrice)}</td>
                        <td class="px-6 py-4 text-right font-bold text-gray-900 dark:text-white">${formatter.format(totalValue)}</td>
                         <td class="px-6 py-4 text-right ${colorClass} font-medium">
                            ${sign}${formatter.format(profitLoss)} <span class="text-xs opacity-75">(${sign}${profitLossPercent}%)</span>
                        </td>
                    </tr>
                `;
                })
                .join("");
        }
    });
</script>
